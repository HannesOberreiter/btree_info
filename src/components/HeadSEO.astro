---
import type { Graph } from 'schema-dts';
import { OPEN_GRAPH, SITE } from '../config';
import Schema from './SchemaLD.astro';

export interface Props {
  frontmatter: any
  site?: any
  canonicalURL: URL | string
}
const curLoc = Astro.currentLocale;
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const { frontmatter = {} } = Astro.props;
const formattedContentTitle = frontmatter.title
  ? `${frontmatter.title} üêù ${SITE.title}`
  : SITE.title;
const imageSrc = frontmatter?.image?.src ?? OPEN_GRAPH.image.src;
const canonicalImageSrc = new URL(imageSrc, Astro.site);
const imageAlt = frontmatter?.image?.alt ?? OPEN_GRAPH.image.alt;

/* Schema.org structured data for the page */
const schemaEN: Graph['@graph'] = [
    {
        '@type': 'Organization',
        'name': 'b.tree',
        'description': SITE.description,
        'url': 'https://www.btree.at/',
        'logo': 'https://www.btree.at/logo.png',
        'areaServed': {
            '@type': 'Place',
            'name': 'Worldwide',
        },
        'contactPoint': {
            '@type': 'ContactPoint',
            'contactType': 'Customer Service',
            'availableLanguage': ['English', 'German'],
            'url': 'https://www.btree.at/impressum/',
        },
    },
];

const schemaDE: Graph['@graph'] = [
    {
        '@type': 'Organization',
        'name': 'b.tree',
        'description': SITE.description,
        'url': 'https://www.btree.at/de/',
        'logo': 'https://www.btree.at/logo.png',
        'areaServed': {
            '@type': 'Place',
            'name': 'Worldwide',
        },
        'contactPoint': {
            '@type': 'ContactPoint',
            'contactType': 'Kundendienst',
            'availableLanguage': ['English', 'German'],
            'url': 'https://www.btree.at/de/impressum/',
        },
    },
];


const schema: Graph = {
    '@context': 'https://schema.org',
    '@graph': [
        ...(curLoc === 'de' ? schemaDE : schemaEN),
        {
            '@type': 'WebPage',
            'name': formattedContentTitle,
            'description': frontmatter.description,
            'url': Astro.url.toString(),
            'inLanguage': curLoc,
        },
    ],
};
---

<!-- Page Metadata -->
<link rel="canonical" href={canonicalURL} />

<!-- OpenGraph Tags -->
<meta property="og:title" content={formattedContentTitle} />
<meta property="og:image" content={canonicalImageSrc} />
<meta property="og:image:alt" content={imageAlt} />
<meta
  name="description"
  property="og:description"
  content={frontmatter.description ? frontmatter.description : SITE.description}
/>
<meta property="og:image:type" content="image/jpeg" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:site_name" content={SITE.title} />
<meta property="og:type" content="article" />
<meta property="og:url" content={canonicalURL} />
<meta
  property="og:locale"
  content={frontmatter.ogLocale ?? SITE.defaultLanguage}
/>
<meta property="og:locale:alternate" content="en_EN" />
<meta property="og:locale:alternate" content="de_DE" />

<!-- Twitter Tags -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content={OPEN_GRAPH.twitter} />
<meta name="twitter:title" content={formattedContentTitle} />
<meta
  name="twitter:description"
  content={frontmatter.description ? frontmatter.description : SITE.description}
/>
<meta name="twitter:image" content={canonicalImageSrc} />
<meta name="twitter:image:alt" content={imageAlt} />
<Schema item={schema} />
